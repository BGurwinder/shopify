<style>
  #shopify-section-{{ section.id }} .container-section {
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
    background-color: {{ section.settings.bg_color }};
    {% if section.settings.bg_image != blank %}
      background-image: url('{{ section.settings.bg_image | image_url: width: 2000 }}');
      background-size: cover;
      background-position: center;
    {% endif %}
  }

  #shopify-section-{{ section.id }} .container-wrapper {
    {% if section.settings.container_width == 'page_width' %}
      max-width: var(--page-width);
      margin: 0 auto;
      padding: 0 2rem;
    {% elsif section.settings.container_width == 'custom' %}
      max-width: {{ section.settings.custom_width }}px;
      margin: 0 auto;
      padding: 0 2rem;
    {% else %}
      width: 100%;
      padding: 0 2rem;
    {% endif %}
  }

  #shopify-section-{{ section.id }} .container-grid {
    display: {{ section.settings.layout_mode }};

    {% if section.settings.layout_mode == 'grid' %}
      grid-template-columns: {{ section.settings.grid_columns_mobile }};
      gap: {{ section.settings.gap_mobile }}px;
    {% elsif section.settings.layout_mode == 'flex' %}
      flex-direction: column;
      gap: {{ section.settings.gap_mobile }}px;
    {% endif %}

    align-items: {{ section.settings.align_items }};
    justify-content: {{ section.settings.justify_content }};
  }

  @media screen and (min-width: 768px) {
    #shopify-section-{{ section.id }} .container-grid {
      {% if section.settings.layout_mode == 'grid' %}
        grid-template-columns: {{ section.settings.grid_columns_desktop }};
        gap: {{ section.settings.gap_desktop }}px;
      {% elsif section.settings.layout_mode == 'flex' %}
        flex-direction: row;
        gap: {{ section.settings.gap_desktop }}px;
      {% endif %}
    }
  }

  /* Block Styles */
  #shopify-section-{{ section.id }} .container-block {
    width: 100%;
  }

  /* Accordion Styles (Scoped) */
  #shopify-section-{{ section.id }} .accordion-item {
    border-bottom: 1px solid #e5e5e5;
  }
  #shopify-section-{{ section.id }} .accordion-header {
    width: 100%;
    padding: 1rem 0;
    background: transparent;
    border: none;
    text-align: left;
    font-size: 1.1rem;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  #shopify-section-{{ section.id }} .accordion-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-out;
  }

  /* Trust Badge Styles (Scoped) */
  #shopify-section-{{ section.id }} .badge-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.5rem 0;
  }
  #shopify-section-{{ section.id }} .badge-icon {
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  #shopify-section-{{ section.id }} .badge-icon svg,
  #shopify-section-{{ section.id }} .badge-icon img {
    width: 100%;
    height: 100%;
  }
</style>

<div class="container-section">
  <div class="container-wrapper">
    <div class="container-grid">
      {% for block in section.blocks %}
        {% case block.type %}
          {% when 'container_start' %}
            {% comment %}
              WARNING: Ensure every 'Container Start' block has a matching 'Container End' block.
              Mismatched blocks will break the layout.
            {% endcomment %}
            <div
              class="nested-container"
              style="
                width: 100%;
                padding: {{ block.settings.padding }}px;
                margin: {{ block.settings.margin }}px 0;
                background-color: {{ block.settings.bg_color }};
                border: {{ block.settings.border_width }}px solid {{ block.settings.border_color }};
                border-radius: {{ block.settings.border_radius }}px;
                display: {{ block.settings.layout_mode }};
                {% if block.settings.layout_mode == 'grid' %}
                  display: grid;
                  grid-template-columns: {{ block.settings.grid_columns_mobile }};
                  gap: {{ block.settings.gap }}px;
                {% elsif block.settings.layout_mode == 'flex' %}
                  display: flex;
                  flex-direction: column;
                  gap: {{ block.settings.gap }}px;
                {% endif %}
                align-items: {{ block.settings.align_items }};
                justify-content: {{ block.settings.justify_content }};
                --desktop-columns: {{ block.settings.grid_columns_desktop }};
              "
              {{ block.shopify_attributes }}
            >
              <style>
                @media screen and (min-width: 768px) {
                  #shopify-section-{{ section.id }} .nested-container[data-block-id="{{ block.id }}"] {
                    {% if block.settings.layout_mode == 'grid' %}
                      grid-template-columns: {{ block.settings.grid_columns_desktop }} !important;
                    {% elsif block.settings.layout_mode == 'flex' %}
                      flex-direction: row !important;
                    {% endif %}
                  }
                }
              </style>
              <!-- Add data attribute for specific styling if needed -->
              <script>
                // Small hack to add data-block-id to the previous element (the div we just opened)
                document.currentScript.previousElementSibling.setAttribute('data-block-id', '{{ block.id }}');
              </script>
          {% when 'container_end' %}
            </div>

          {% else %}
            <div class="container-block" {{ block.shopify_attributes }}>
              {% case block.type %}
                {% when 'custom_liquid' %}
                  {{ block.settings.custom_liquid }}

                {% when 'text' %}
                  <div style="text-align: {{ block.settings.text_align }}; color: {{ block.settings.text_color }};">
                    {% if block.settings.heading != blank %}
                      <h2 style="font-size: {{ block.settings.heading_size }}px; margin-bottom: 10px;">
                        {{ block.settings.heading }}
                      </h2>
                    {% endif %}
                    <div style="font-size: {{ block.settings.text_size }}px;">
                      {{ block.settings.text }}
                    </div>
                  </div>

                {% when 'image' %}
                  {% if block.settings.image != blank %}
                    {{
                      block.settings.image
                      | image_url: width: 1000
                      | image_tag: style: 'width: 100%; height: auto; display: block;'
                    }}
                  {% else %}
                    {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
                  {% endif %}

                {% when 'button' %}
                  <div style="text-align: {{ block.settings.align }};">
                    <a
                      href="{{ block.settings.link }}"
                      class="button"
                      style="background-color: {{ block.settings.btn_bg_color }}; color: {{ block.settings.btn_text_color }};"
                    >
                      {{ block.settings.label }}
                    </a>
                  </div>

                {% when 'accordion' %}
                  <div class="accordion-item" style="border-bottom: 1px solid {{ block.settings.border_color }};">
                    <button
                      type="button"
                      class="accordion-header"
                      style="
                        color: {{ block.settings.heading_color }};
                        font-size: {{ block.settings.heading_size }}px;
                        justify-content: {{ block.settings.text_align }};
                      "
                    >
                      {{ block.settings.heading }}
                      <span class="icon-plus" style="color: {{ block.settings.icon_color }};">+</span>
                    </button>
                    <div class="accordion-content" style="color: {{ block.settings.content_color }};">
                      {{ block.settings.content }}
                    </div>
                  </div>

                {% when 'trust_badge' %}
                  <div class="badge-item">
                    <span class="badge-icon">
                      {% if block.settings.icon_svg != blank %}
                        {{ block.settings.icon_svg }}
                      {% elsif block.settings.icon_image != blank %}
                        {{ block.settings.icon_image | image_url: width: 24 | image_tag }}
                      {% else %}
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                          <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                        </svg>
                      {% endif %}
                    </span>
                    <span>{{ block.settings.text }}</span>
                  </div>

                {% when 'video' %}
                  <div
                    class="video-container"
                    style="
                      position: relative;
                      width: {{ block.settings.width }}{{ block.settings.width_unit }};
                      height: {{ block.settings.height }}{{ block.settings.height_unit }};
                      max-width: 100%;
                      overflow: hidden;
                      {% unless block.settings.enable_pointer_events %}
                        pointer-events: none;
                      {% endunless %}
                    "
                  >
                    {% if block.settings.video_source == 'youtube' %}
                      {% if block.settings.video_url != blank %}
                        {% assign video_id = block.settings.video_url.id %}
                        {% assign loop_param = '' %}
                        {% if block.settings.loop %}
                          {% assign loop_param = '&loop=1&playlist=' | append: video_id %}
                        {% endif %}
                        {% assign autoplay_param = '' %}
                        {% if block.settings.autoplay %}
                          {% assign autoplay_param = '&autoplay=1&mute=1' %}
                        {% endif %}

                        <iframe
                          src="https://www.youtube.com/embed/{{ video_id }}?enablejsapi=1{{ autoplay_param }}{{ loop_param }}&controls={{ block.settings.controls | default: 1 }}"
                          class="js-youtube"
                          allow="autoplay; encrypted-media"
                          allowfullscreen
                          style="width: 100%; height: 100%; object-fit: cover; border: none;"
                        ></iframe>
                      {% else %}
                        {{ 'lifestyle-1' | placeholder_svg_tag: 'placeholder-svg' }}
                      {% endif %}
                    {% elsif block.settings.video_source == 'shopify' %}
                      {% if block.settings.video != blank %}
                        {{
                          block.settings.video
                          | video_tag:
                            image_size: '1100x',
                            loop: block.settings.loop,
                            controls: block.settings.controls,
                            muted: block.settings.muted,
                            autoplay: block.settings.autoplay,
                            style: 'width: 100%; height: 100%; object-fit: cover;'
                        }}
                      {% else %}
                        {{ 'lifestyle-1' | placeholder_svg_tag: 'placeholder-svg' }}
                      {% endif %}
                    {% elsif block.settings.video_source == 'external' %}
                      {% if block.settings.external_url != blank %}
                        {% if block.settings.external_url contains '<iframe' %}
                          <div style="width: 100%; height: 100%;">{{ block.settings.external_url }}</div>
                        {% else %}
                          <iframe
                            src="{{ block.settings.external_url }}"
                            allowfullscreen
                            style="width: 100%; height: 100%; border: none;"
                          ></iframe>
                        {% endif %}
                      {% else %}
                        <div style="display:flex;align-items:center;justify-content:center;height:100%;background:#f0f0f0;color:#888;">
                          External Video Placeholder
                        </div>
                      {% endif %}
                    {% endif %}
                  </div>
              {% endcase %}
            </div>
        {% endcase %}
      {% endfor %}
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Container (Advanced)",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Layout Settings"
    },
    {
      "type": "select",
      "id": "layout_mode",
      "label": "Layout Mode",
      "options": [
        { "value": "grid", "label": "CSS Grid" },
        { "value": "flex", "label": "Flexbox" },
        { "value": "block", "label": "Block" }
      ],
      "default": "grid"
    },
    {
      "type": "select",
      "id": "container_width",
      "label": "Container Width",
      "options": [
        { "value": "page_width", "label": "Page Width" },
        { "value": "full_width", "label": "Full Width" },
        { "value": "custom", "label": "Custom Width" }
      ],
      "default": "page_width"
    },
    {
      "type": "number",
      "id": "custom_width",
      "label": "Custom Max Width (px)",
      "default": 1200
    },
    {
      "type": "header",
      "content": "Grid Settings (Desktop)"
    },
    {
      "type": "text",
      "id": "grid_columns_desktop",
      "label": "Grid Template Columns",
      "default": "1fr 1fr",
      "info": "e.g., '1fr 1fr 1fr' or 'repeat(3, 1fr)' or '30% 70%'"
    },
    {
      "type": "range",
      "id": "gap_desktop",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Gap",
      "default": 20
    },
    {
      "type": "header",
      "content": "Grid Settings (Mobile)"
    },
    {
      "type": "text",
      "id": "grid_columns_mobile",
      "label": "Grid Template Columns",
      "default": "1fr",
      "info": "e.g., '1fr' or '1fr 1fr'"
    },
    {
      "type": "range",
      "id": "gap_mobile",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Gap",
      "default": 16
    },
    {
      "type": "header",
      "content": "Alignment"
    },
    {
      "type": "select",
      "id": "align_items",
      "label": "Align Items (Vertical)",
      "options": [
        { "value": "start", "label": "Start" },
        { "value": "center", "label": "Center" },
        { "value": "end", "label": "End" },
        { "value": "stretch", "label": "Stretch" }
      ],
      "default": "start"
    },
    {
      "type": "select",
      "id": "justify_content",
      "label": "Justify Content (Horizontal)",
      "options": [
        { "value": "start", "label": "Start" },
        { "value": "center", "label": "Center" },
        { "value": "end", "label": "End" },
        { "value": "space-between", "label": "Space Between" },
        { "value": "space-around", "label": "Space Around" }
      ],
      "default": "start"
    },
    {
      "type": "header",
      "content": "Appearance"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#ffffff"
    },
    {
      "type": "image_picker",
      "id": "bg_image",
      "label": "Background Image"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding Top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 36
    }
  ],
  "blocks": [
    {
      "type": "container_start",
      "name": "Container Start",
      "settings": [
        {
          "type": "header",
          "content": "Layout (WARNING: Must be closed with Container End)"
        },
        {
          "type": "select",
          "id": "layout_mode",
          "label": "Layout Mode",
          "options": [
            { "value": "grid", "label": "CSS Grid" },
            { "value": "flex", "label": "Flexbox" },
            { "value": "block", "label": "Block" }
          ],
          "default": "block"
        },
        {
          "type": "text",
          "id": "grid_columns_desktop",
          "label": "Grid Columns (Desktop)",
          "default": "1fr 1fr"
        },
        {
          "type": "text",
          "id": "grid_columns_mobile",
          "label": "Grid Columns (Mobile)",
          "default": "1fr"
        },
        {
          "type": "range",
          "id": "gap",
          "min": 0,
          "max": 100,
          "step": 4,
          "unit": "px",
          "label": "Gap",
          "default": 20
        },
        {
          "type": "select",
          "id": "align_items",
          "label": "Align Items",
          "options": [
            { "value": "start", "label": "Start" },
            { "value": "center", "label": "Center" },
            { "value": "end", "label": "End" },
            { "value": "stretch", "label": "Stretch" }
          ],
          "default": "start"
        },
        {
          "type": "select",
          "id": "justify_content",
          "label": "Justify Content",
          "options": [
            { "value": "start", "label": "Start" },
            { "value": "center", "label": "Center" },
            { "value": "end", "label": "End" },
            { "value": "space-between", "label": "Space Between" }
          ],
          "default": "start"
        },
        {
          "type": "header",
          "content": "Appearance"
        },
        {
          "type": "color",
          "id": "bg_color",
          "label": "Background Color",
          "default": "transparent"
        },
        {
          "type": "range",
          "id": "padding",
          "min": 0,
          "max": 100,
          "step": 4,
          "unit": "px",
          "label": "Padding",
          "default": 0
        },
        {
          "type": "range",
          "id": "margin",
          "min": 0,
          "max": 100,
          "step": 4,
          "unit": "px",
          "label": "Margin (Top/Bottom)",
          "default": 0
        },
        {
          "type": "color",
          "id": "border_color",
          "label": "Border Color",
          "default": "#e5e5e5"
        },
        {
          "type": "range",
          "id": "border_width",
          "min": 0,
          "max": 10,
          "step": 1,
          "unit": "px",
          "label": "Border Width",
          "default": 0
        },
        {
          "type": "range",
          "id": "border_radius",
          "min": 0,
          "max": 40,
          "step": 2,
          "unit": "px",
          "label": "Border Radius",
          "default": 0
        }
      ]
    },
    {
      "type": "container_end",
      "name": "Container End",
      "settings": []
    },
    {
      "type": "custom_liquid",
      "name": "Custom Liquid (Dev)",
      "settings": [
        {
          "type": "liquid",
          "id": "custom_liquid",
          "label": "Custom Liquid / HTML",
          "info": "Write your custom code here."
        }
      ]
    },
    {
      "type": "text",
      "name": "Text Block",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Block Heading"
        },
        {
          "type": "richtext",
          "id": "text",
          "label": "Text",
          "default": "<p>Block content goes here.</p>"
        },
        {
          "type": "color",
          "id": "text_color",
          "label": "Text Color",
          "default": "#000000"
        },
        {
          "type": "range",
          "id": "heading_size",
          "min": 12,
          "max": 60,
          "step": 1,
          "unit": "px",
          "label": "Heading Size",
          "default": 24
        },
        {
          "type": "range",
          "id": "text_size",
          "min": 12,
          "max": 30,
          "step": 1,
          "unit": "px",
          "label": "Text Size",
          "default": 16
        },
        {
          "type": "select",
          "id": "text_align",
          "label": "Text Alignment",
          "options": [
            { "value": "left", "label": "Left" },
            { "value": "center", "label": "Center" },
            { "value": "right", "label": "Right" }
          ],
          "default": "left"
        }
      ]
    },
    {
      "type": "image",
      "name": "Image Block",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        }
      ]
    },
    {
      "type": "button",
      "name": "Button Block",
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Button Label",
          "default": "Click Me"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Button Link"
        },
        {
          "type": "color",
          "id": "btn_bg_color",
          "label": "Button Background",
          "default": "#000000"
        },
        {
          "type": "color",
          "id": "btn_text_color",
          "label": "Button Text",
          "default": "#ffffff"
        },
        {
          "type": "select",
          "id": "align",
          "label": "Alignment",
          "options": [
            { "value": "left", "label": "Left" },
            { "value": "center", "label": "Center" },
            { "value": "right", "label": "Right" }
          ],
          "default": "left"
        }
      ]
    },
    {
      "type": "accordion",
      "name": "Accordion",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Accordion Heading"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Content",
          "default": "<p>Accordion content.</p>"
        },
        {
          "type": "header",
          "content": "Style Settings"
        },
        {
          "type": "range",
          "id": "heading_size",
          "min": 12,
          "max": 40,
          "step": 1,
          "unit": "px",
          "label": "Heading Font Size",
          "default": 16
        },
        {
          "type": "color",
          "id": "heading_color",
          "label": "Heading Color",
          "default": "#000000"
        },
        {
          "type": "color",
          "id": "content_color",
          "label": "Content Color",
          "default": "#333333"
        },
        {
          "type": "color",
          "id": "border_color",
          "label": "Border Color",
          "default": "#e5e5e5"
        },
        {
          "type": "color",
          "id": "icon_color",
          "label": "Icon Color",
          "default": "#000000"
        },
        {
          "type": "select",
          "id": "text_align",
          "label": "Alignment",
          "options": [
            { "value": "flex-start", "label": "Left" },
            { "value": "center", "label": "Center" },
            { "value": "flex-end", "label": "Right" },
            { "value": "space-between", "label": "Space Between" }
          ],
          "default": "space-between"
        }
      ]
    },
    {
      "type": "trust_badge",
      "name": "Trust Badge",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Text",
          "default": "Trust Badge"
        },
        {
          "type": "html",
          "id": "icon_svg",
          "label": "Icon SVG",
          "info": "Paste SVG code here"
        },
        {
          "type": "image_picker",
          "id": "icon_image",
          "label": "Icon Image"
        }
      ]
    },
    {
      "type": "video",
      "name": "Video Block",
      "settings": [
        {
          "type": "header",
          "content": "Video Settings"
        },
        {
          "type": "select",
          "id": "video_source",
          "label": "Video Source",
          "options": [
            { "value": "youtube", "label": "YouTube" },
            { "value": "shopify", "label": "Shopify Hosted" },
            { "value": "external", "label": "External / Embed (Drive)" }
          ],
          "default": "shopify"
        },
        {
          "type": "video_url",
          "id": "video_url",
          "accept": ["youtube", "vimeo"],
          "default": "https://www.youtube.com/watch?v=_9VUPq3SxOc",
          "label": "YouTube/Vimeo URL",
          "info": "Used when source is YouTube"
        },
        {
          "type": "video",
          "id": "video",
          "label": "Shopify Hosted Video",
          "info": "Used when source is Shopify Hosted"
        },
        {
          "type": "textarea",
          "id": "external_url",
          "label": "External URL or Embed Code",
          "info": "Paste the Google Drive Embed code (iframe) or a direct URL here."
        },
        {
          "type": "header",
          "content": "Playback (Shopify Only)"
        },
        {
          "type": "checkbox",
          "id": "autoplay",
          "label": "Autoplay",
          "default": false
        },
        {
          "type": "checkbox",
          "id": "loop",
          "label": "Loop",
          "default": false
        },
        {
          "type": "checkbox",
          "id": "muted",
          "label": "Mute",
          "default": false
        },
        {
          "type": "checkbox",
          "id": "controls",
          "label": "Show Controls",
          "default": true
        },
        {
          "type": "header",
          "content": "Dimensions"
        },
        {
          "type": "number",
          "id": "width",
          "label": "Width",
          "default": 100
        },
        {
          "type": "select",
          "id": "width_unit",
          "label": "Width Unit",
          "options": [
            { "value": "%", "label": "%" },
            { "value": "px", "label": "px" },
            { "value": "vw", "label": "vw" }
          ],
          "default": "%"
        },
        {
          "type": "number",
          "id": "height",
          "label": "Height",
          "default": 300
        },
        {
          "type": "select",
          "id": "height_unit",
          "label": "Height Unit",
          "options": [
            { "value": "px", "label": "px" },
            { "value": "vh", "label": "vh" },
            { "value": "%", "label": "%" }
          ],
          "default": "px"
        },
        {
          "type": "checkbox",
          "id": "enable_pointer_events",
          "label": "Enable Interaction (Pointer Events)",
          "default": true,
          "info": "Uncheck to disable clicking on the video."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Container Section",
      "blocks": [
        {
          "type": "text"
        },
        {
          "type": "text"
        }
      ]
    }
  ]
}
{% endschema %}
